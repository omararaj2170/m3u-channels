<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Satellite IPTV</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: black;
  color: white;
  font-family: Arial, sans-serif;
  overflow: hidden;
}

/* ===== VIDEO ===== */
#video {
  width: 100vw;
  height: 100vh;
  background: black;
}

/* ===== INFO BAR ===== */
#info {
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 110px;
  background: linear-gradient(to top, rgba(0,0,0,.85), transparent);
  display: flex;
  align-items: center;
  padding: 20px;
  gap: 20px;
  font-size: 22px;
  opacity: 0;
  transition: opacity .3s;
}

#info.show {
  opacity: 1;
}

#ch-num {
  font-size: 36px;
  font-weight: bold;
  color: #00ff88;
}

#ch-name {
  font-size: 26px;
}

/* ===== LOADING ===== */
#loading {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}
</style>
</head>

<body>

<div id="loading">Scanning channelsâ€¦</div>

<video id="video" controls autoplay></video>

<div id="info">
  <div id="ch-num">001</div>
  <div id="ch-name">Channel</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const M3U_URL = "./playlist.m3u";

let channels = [];
let current = 0;
let hls;
let infoTimer;

/* ===== LOAD PLAYLIST ===== */
fetch(M3U_URL)
  .then(r => r.text())
  .then(parseM3U);

function parseM3U(data) {
  const lines = data.split("\n");
  let ch = {};

  for (let line of lines) {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      ch = { name: line.split(",").pop() };
    } else if (line.startsWith("http")) {
      ch.url = line;
      channels.push(ch);
    }
  }

  document.getElementById("loading").style.display = "none";
  play(0);
}

/* ===== PLAY ===== */
function play(index) {
  if (!channels[index]) return;

  current = index;
  showInfo();

  const video = document.getElementById("video");
  const url = channels[index].url;

  if (Hls.isSupported()) {
    if (hls) hls.destroy();
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

/* ===== INFO BAR ===== */
function showInfo() {
  const info = document.getElementById("info");
  document.getElementById("ch-num").textContent =
    String(current + 1).padStart(3, "0");
  document.getElementById("ch-name").textContent =
    channels[current].name;

  info.classList.add("show");

  clearTimeout(infoTimer);
  infoTimer = setTimeout(() => info.classList.remove("show"), 3000);
}

/* ===== REMOTE CONTROLS ===== */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") {
    play((current + 1) % channels.length);
  }

  if (e.key === "ArrowDown") {
    play((current - 1 + channels.length) % channels.length);
  }

  if (e.key === "Enter" || e.key === "Info") {
    showInfo();
  }
});
</script>

</body>
</html>
