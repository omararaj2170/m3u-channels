<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Player</title>

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: #0b0b0b;
  color: white;
  font-family: Arial, sans-serif;
}

/* ===== PLAYER ===== */
#player {
  position: relative;
  z-index: 1;
  background: black;
}

video {
  width: 100%;
  height: auto;
}

/* ===== SEARCH ===== */
#search {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: none;
  outline: none;
  background: #111;
  color: white;
}

/* ===== CHANNEL LIST ===== */
#channels {
  position: relative;
  z-index: 10;
  height: calc(100vh - 220px);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.group {
  padding: 8px 12px;
  font-size: 13px;
  font-weight: bold;
  background: #111;
  color: #aaa;
  border-bottom: 1px solid #222;
}

.channel {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px;
  border-bottom: 1px solid #222;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.channel:active {
  background: #222;
}

.channel img {
  width: 42px;
  height: 42px;
  object-fit: contain;
  background: #000;
  border-radius: 6px;
}
</style>
</head>

<body>

<div id="player">
  <video id="video" controls playsinline muted></video>
</div>

<input id="search" placeholder="Search channels...">

<div id="channels"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const M3U_URL = "https://raw.githubusercontent.com/omararaj2170/m3u-channels/main/playlist.m3u";

let allChannels = [];
let hls;

fetch(M3U_URL)
  .then(r => r.text())
  .then(parseM3U)
  .catch(err => console.error(err));

function parseM3U(data) {
  const lines = data.split("\n");
  let ch = {};

  for (let line of lines) {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      ch = {
        name: line.split(",").pop(),
        logo: (line.match(/tvg-logo="([^"]+)"/) || [])[1] || "",
        group: (line.match(/group-title="([^"]+)"/) || [])[1] || "Other"
      };
    } 
    else if (line.startsWith("http")) {
      ch.url = line;
      allChannels.push(ch);
    }
  }

  render(allChannels);
}

function render(list) {
  const container = document.getElementById("channels");
  container.innerHTML = "";
  let currentGroup = "";

  list.forEach(ch => {
    if (ch.group !== currentGroup) {
      currentGroup = ch.group;
      const g = document.createElement("div");
      g.className = "group";
      g.textContent = currentGroup;
      container.appendChild(g);
    }

    const div = document.createElement("div");
    div.className = "channel";

    div.innerHTML = `
      <img src="${ch.logo}" onerror="this.style.display='none'">
      <span>${ch.name}</span>
    `;

    div.addEventListener("touchstart", () => play(ch.url), { passive: true });
    div.addEventListener("click", () => play(ch.url));

    container.appendChild(div);
  });
}

function play(url) {
  const video = document.getElementById("video");

  if (Hls.isSupported()) {
    if (hls) hls.destroy();
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  render(allChannels.filter(c => c.name.toLowerCase().includes(q)));
});
</script>

</body>
</html>
